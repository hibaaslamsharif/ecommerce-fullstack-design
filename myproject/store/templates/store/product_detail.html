{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Product Detail - Ecommerce</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  
  <link rel="stylesheet" href="{% static 'store/css/index.css' %}">   
   <script src="{% static 'store/script.js' %}"></script>
  <style>
    :root {
        --primary-color: #e53e3e;  /* Red 600 */
        --primary-dark: #c53030;   /* Red 700 */
        --primary-light: #feb2b2;  /* Red 200 */
        --primary-bg: #fff5f5;     /* Red 50 */
    }
    
    /* Base styles */
    body {
        background-color: #fff5f5;
        font-family: 'Roboto', Arial, sans-serif;
    }
    
    /* Header styles */
    .top-header {
        background-color: white;
        border-bottom: 1px solid #fed7d7;
        padding: 1rem 0;
    }
    
    .logo {
        color: #e53e3e;
        font-weight: 700;
        font-size: 1.5rem;
    }
    
    .search-bar input {
        border: 1px solid #fed7d7;
    }
    
    .search-bar button {
        background-color: #e53e3e;
        color: white;
        border: none;
    }
    
    .cart-icon {
        color: #e53e3e;
    }
    
    .cart-count {
        background-color: #e53e3e;
        color: white;
    }
    
    /* Product detail styles */
    .product-detail-container {
        background: white;
        border: 1px solid #fed7d7;
        border-radius: 8px;
        overflow: hidden;
    }
    
    .product-gallery {
        border-right: 1px solid #fed7d7;
    }
    
    .product-info {
        padding: 2rem;
    }
    
    .product-title {
        color: #2d3748;
        font-size: 2rem;
        margin-bottom: 1rem;
    }
    
    .product-price {
        color: #e53e3e;
        font-size: 1.5rem;
        font-weight: 700;
        margin: 1rem 0;
    }
    
    .product-description {
        color: #4a5568;
        line-height: 1.6;
        margin: 1.5rem 0;
    }
    
    .quantity-selector {
        display: flex;
        align-items: center;
        margin: 1.5rem 0;
    }
    
    .qty-btn {
        background-color: #feb2b2;
        color: #e53e3e;
        border: 1px solid #fed7d7;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 1.2rem;
        font-weight: 700;
    }
    
    .qty-input {
        width: 60px;
        height: 36px;
        text-align: center;
        border: 1px solid #fed7d7;
        margin: 0 10px;
        font-size: 1rem;
    }
    
    .add-to-cart-btn {
        background-color: #e53e3e;
        color: white;
        border: none;
        padding: 0.8rem 2rem;
        font-size: 1rem;
        font-weight: 600;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s;
        width: 100%;
        margin-top: 1rem;
    }
    
    .add-to-cart-btn:hover {
        background-color: #c53030;
    }
    
    /* Tabs */
    .tabs {
        border-bottom: 1px solid #fed7d7;
        margin: 2rem 0;
    }
    
    .tab-btn {
        background: none;
        border: none;
        padding: 0.8rem 1.5rem;
        font-size: 1rem;
        color: #4a5568;
        cursor: pointer;
        position: relative;
    }
    
    .tab-btn.active {
        color: #e53e3e;
        font-weight: 600;
    }
    
    .tab-btn.active::after {
        content: '';
        position: absolute;
        bottom: -1px;
        left: 0;
        width: 100%;
        height: 2px;
        background-color: #e53e3e;
    }
    
    .tab-content {
        padding: 1.5rem 0;
        color: #4a5568;
        line-height: 1.6;
    }
    
    /* Related products */
    .related-section {
        margin: 3rem 0;
    }
    
    .section-title {
        color: #2d3748;
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .related-products {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1.5rem;
    }
    
    .related-product {
        background: white;
        border: 1px solid #fed7d7;
        border-radius: 8px;
        overflow: hidden;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .related-product:hover {
        transform: translateY(-4px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .product-badge {
        background-color: #e53e3e;
        color: white;
        padding: 0.3rem 0.8rem;
        font-size: 0.8rem;
        border-radius: 4px;
        position: absolute;
        top: 1rem;
        left: 1rem;
    }
    
    /* Toast notification */
    .toast-notification {
      position: fixed;
      top: 32px;
      right: 32px;
      background: #e53e3e;
      color: #fff;
      padding: 16px 28px;
      border-radius: 8px;
      font-size: 1.08rem;
      font-weight: 500;
      box-shadow: 0 2px 12px rgba(0,0,0,0.12);
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s, transform 0.3s;
      transform: translateY(-20px);
    }
    .toast-notification.show {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }
    /* Modern Nav Bar */
    .nav-bar {
      background: #fff;
      border-bottom: 1.5px solid #e2e8f0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
      margin-bottom: 0;
    }
    .nav-bar .nav-menu {
      display: flex;
      gap: 32px;
      justify-content: center;
      align-items: center;
      padding: 0;
      margin: 0;
      list-style: none;
      min-height: 54px;
    }
    .nav-bar .nav-menu li {
      display: inline-block;
    }
    .nav-bar .nav-menu a {
      color: #2d3748;
      text-decoration: none;
      font-size: 1.08rem;
      font-weight: 500;
      padding: 8px 0 6px 0;
      border-bottom: 2px solid transparent;
      transition: color 0.2s, border-bottom 0.2s;
      display: inline-block;
    }
    .nav-bar .nav-menu a:hover, .nav-bar .nav-menu a.active {
      color: #3182ce;
      border-bottom: 2px solid #3182ce;
    }
    @media (max-width: 800px) {
      .nav-bar .nav-menu {
        gap: 16px;
        font-size: 0.98rem;
      }
    }
    @media (max-width: 600px) {
      .nav-bar .nav-menu {
        flex-wrap: wrap;
        gap: 10px;
        min-height: 44px;
      }
    }
    /* Modern Breadcrumb */
    .breadcrumb-section {
      background: #f8fafc;
      border-bottom: 1px solid #e2e8f0;
      padding: 0.7em 0;
      font-size: 1.01rem;
    }
    .breadcrumb-content {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #4a5568;
      font-weight: 500;
      font-size: 1.01rem;
    }
    .breadcrumb-content a {
      color: #3182ce;
      text-decoration: none;
      transition: color 0.2s;
    }
    .breadcrumb-content a:hover {
      color: #2b6cb0;
      text-decoration: underline;
    }
    .breadcrumb-content .divider {
      color: #a0aec0;
      font-size: 1.1em;
      margin: 0 2px;
    }
    .breadcrumb-content .current {
      color: #2d3748;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="top-header">
    <div class="logo">Brand</div>
    <div class="search-bar">
      <select>
        <option>All category</option>
      </select>
      <input type="text" placeholder="Search"/>
      <button>Search</button>
    </div>
    <div class="header-icons">
      <a href="#" class="header-icon"><i class="far fa-user"></i> Profile</a>
      <a href="#" class="header-icon"><i class="far fa-comment"></i> Message</a>
      <a href="#" class="header-icon"><i class="far fa-clipboard"></i> Orders</a>
      <a href="{% url 'cart' %}" class="header-icon">
  <i class="fas fa-shopping-cart"></i> My Cart
</a>

     </div>
  </header>

  <!-- Navigation Bar -->
  <nav class="nav-bar">
    <ul class="nav-menu">
      <li><a href="{% url 'index' %}">Home</a></li>
      <li><a href="{% url 'product_list' %}">Shop</a></li>
      <li><a href="#">Categories</a></li>
      <li><a href="#">Laptops</a></li>
      <li><a href="#">Smartphones</a></li>
      <li><a href="#">Cameras</a></li>
      <li><a href="#">Accessories</a></li>
    </ul>
  </nav>

  <!-- Breadcrumb Section -->
  <div class="breadcrumb-section">
    <div class="container">
      <div class="breadcrumb-content">
        <a href="{% url 'index' %}">Home</a>
        <span class="divider">/</span>
        <a href="{% url 'product_list' %}">Shop</a>

        <span class="divider">/</span>
        <span class="current">Product Details</span>
      </div>
    </div>
  </div>

  <!-- Product Detail Section -->
   <div class="container">
    <div class="product-detail-container" id="product-detail-container"></div>
  </div>

  <!-- Product Tabs -->
  <div class="product-detail-wrapper">
    <div class="product-detail-card" id="product-loading">
      <p>Loading product details...</p>
    </div>
  </div>

 

  <div class="product-tabs">
    <div class="tab-header">
      <button class="tab-btn active" data-tab="description">Description</button>
      <button class="tab-btn" data-tab="specifications">Specifications</button>
      <button class="tab-btn" data-tab="reviews">Reviews (154)</button>
    </div>
    
    <div class="tab-content">
        <div id="description">

        </div>

      
      <div id="specifications" class="tab-pane">
        <h3>Technical Specifications</h3>
        <table class="specs-table">
          <tr>
            <th>Brand</th>
            <td>GoPro</td>
          </tr>
          <tr>
            <th>Model</th>
            <td>HERO6 Black</td>
          </tr>
          <tr>
            <th>Video Resolution</th>
            <td>4K60, 2.7K120, 1080p240 video</td>
          </tr>
          <tr>
            <th>Photo Resolution</th>
            <td>12MP photos</td>
          </tr>
          <tr>
            <th>Waterproof</th>
            <td>Yes, up to 33ft (10m) without housing</td>
          </tr>
        </table>
      </div>
      
      <div id="reviews" class="tab-pane">
        <h3>Customer Reviews</h3>
        <div class="review">
          <div class="review-header">
            <div class="reviewer">John D.</div>
            <div class="review-rating">
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="far fa-star"></i>
            </div>
            <div class="review-date">April 15, 2023</div>
          </div>
          <div class="review-title">Great camera for action shots!</div>
          <p class="review-text">The video quality is amazing, especially in 4K. Battery life could be better, but overall very satisfied with my purchase.</p>
        </div>
        
        <div class="review">
          <div class="review-header">
            <div class="reviewer">Sarah M.</div>
            <div class="review-rating">
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
            </div>
            <div class="review-date">March 28, 2023</div>
          </div>
          <div class="review-title">Perfect for my vlogging needs</div>
          <p class="review-text">The image stabilization is a game changer. I use it for my travel vlogs and the footage is always smooth and crisp.</p>
        </div>
        
        <button class="write-review-btn">Write a Review</button>
      </div>
    </div>
  </div>

  <!-- Related Products -->
  <div class="related-section">
    <h2>You May Also Like</h2>
    <div class="related-products">
      <div class="related-product">
        <div class="product-badge">-15%</div>
        <img src="https://via.placeholder.com/200x200?text=Product+1" alt="Related Product 1" />
        <h3>GoPro HERO9 Black</h3>
        <div class="price">$449.99 <span class="old-price">$529.99</span></div>
        <button class="add-to-cart-btn">Add to Cart</button>
      </div>
      
      <div class="related-product">
        <div class="product-badge new">New</div>
        <img src="https://via.placeholder.com/200x200?text=Product+2" alt="Related Product 2" />
        <h3>DJI Osmo Action</h3>
        <div class="price">$349.00</div>
        <button class="add-to-cart-btn">Add to Cart</button>
      </div>
      
      <div class="related-product">
        <img src="https://via.placeholder.com/200x200?text=Product+3" alt="Related Product 3" />
        <h3>Insta360 ONE X2</h3>
        <div class="price">$429.99</div>
        <button class="add-to-cart-btn">Add to Cart</button>
      </div>
      
      <div class="related-product">
        <img src="https://via.placeholder.com/200x200?text=Product+4" alt="Related Product 4" />
        <h3>Sony RX0 II</h3>
        <div class="price">$699.99</div>
        <button class="add-to-cart-btn">Add to Cart</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-container">
      <div class="footer-section">
        <h3>About Us</h3>
        <p>We offer the best products at competitive prices with excellent customer service.</p>
      </div>
      <div class="footer-section">
        <h3>Quick Links</h3>
        <ul>
          <li><a href="#">Home</a></li>
          <li><a href="#">Shop</a></li>
          <li><a href="#">About</a></li>
          <li><a href="#">Contact</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h3>Customer Service</h3>
        <ul>
          <li><a href="#">Contact Us</a></li>
          <li><a href="#">FAQs</a></li>
          <li><a href="#">Shipping & Returns</a></li>
          <li><a href="#">Privacy Policy</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h3>Newsletter</h3>
        <p>Subscribe to get updates on new arrivals and special offers.</p>
        <form class="newsletter-form">
          <input type="email" placeholder="Enter your email" required />
          <button type="submit">Subscribe</button>
        </form>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2023 YourBrand. All rights reserved.</p>
    </div>
  </footer>

  <!-- Toast Notification -->
  <div id="toast" class="toast-notification">Added successfully!</div>
  {% csrf_token %}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const tabBtns = document.querySelectorAll('.tab-btn');
      const tabPanes = document.querySelectorAll('.tab-pane');
      
      // Tab functionality
      tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const target = btn.getAttribute('data-tab');
          
          // Update active tab button
          tabBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          // Show target tab content
          tabPanes.forEach(pane => {
            if (pane.id === target) {
              pane.classList.add('active');
            } else {
              pane.classList.remove('active');
            }
          });
        });
      });

      // Initialize first tab as active
      if (tabBtns.length > 0) {
        tabBtns[0].click();
      }

      // Quantity selector
      const minusBtn = document.querySelector('.qty-btn.minus');
      const plusBtn = document.querySelector('.qty-btn.plus');
      const qtyInput = document.querySelector('.qty-input');
      
      if (minusBtn && plusBtn && qtyInput) {
        minusBtn.addEventListener('click', (e) => {
          e.preventDefault();
          let value = parseInt(qtyInput.value) || 1;
          if (value > 1) {
            qtyInput.value = value - 1;
          }
        });
        
        plusBtn.addEventListener('click', (e) => {
          e.preventDefault();
          let value = parseInt(qtyInput.value) || 1;
          qtyInput.value = value + 1;
        });
      }
    });

    // Add to cart function (moved to the bottom of the file)

    // Function to update cart count in the header
    function updateCartCount() {
      fetch('/cart/count/')
        .then(response => response.json())
        .then(data => {
          if (data.count !== undefined) {
            const cartCount = document.querySelector('.cart-count');
            if (cartCount) {
              cartCount.textContent = data.count;
            }
          }
        })
        .catch(error => console.error('Error updating cart count:', error));
    }

    // Show toast notification
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast-notification ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      // Trigger reflow
      void toast.offsetWidth;
      
      // Show toast
      toast.classList.add('show');
      
      // Hide after 3 seconds
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 300);
      }, 3000);
    }
  </script>
  
  <!-- Add CSRF token for AJAX requests -->
  {% csrf_token %}
  
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const pathParts = window.location.pathname.split('/');
      const id = pathParts[pathParts.length - 2]; // for /store/products/2/

      const detail = document.getElementById('product-detail-container');
      const loadingCard = document.getElementById('product-loading');
      const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

      if (!id || isNaN(id)) {
        detail.innerHTML = `<p style="color:red;">No valid product ID found in URL.</p>`;
        if (loadingCard) loadingCard.style.display = 'none';
        return;
      }

      fetch(`http://127.0.0.1:8000/store/api/products/${id}/`)


        .then(res => {
          if (!res.ok) {
            throw new Error("Product not found.");
          }
          return res.json();
        })
        .then(product => {
          detail.innerHTML = `
            <div class="product-detail-card">
              <img src="${product.image || 'https://via.placeholder.com/300x300'}" alt="${product.name}" style="max-width:300px;">
              <h2>${product.name}</h2>
              <div class="price">Rs. ${product.price}</div>
              

              <p class="cat">Category: ${product.category?.name || 'N/A'}</p>
              <p class="stock ${product.stock > 0 ? '' : 'out-of-stock'}">
                ${product.stock > 0 ? 'In Stock: ' + product.stock : 'Out of Stock'}
              </p>
              <button class="add-cart" onclick="addToCart(${product.id})" ${product.stock <= 0 ? 'disabled' : ''}>
                ${product.stock > 0 ? 'Add to Cart' : 'Out of Stock'}
              </button>
            </div>
               
          `;
          document.getElementById('description').innerHTML = `<p>${product.description}</p>`;
          if (loadingCard) loadingCard.style.display = 'none';
        })
        .catch(error => {
          detail.innerHTML = `<p style="color:red;">${error.message}</p>`;
          if (loadingCard) loadingCard.style.display = 'none';
        });
      // Add to cart function
      window.addToCart = function (productId) {
        const qty = 1; // Default quantity to 1
        
        // Get the CSRF token
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        if (!csrfToken) {
          console.error('CSRF token not found');
          showToast('Security error. Please refresh the page and try again.', 'error');
          return;
        }
        
        // Create form data
        const formData = new FormData();
        formData.append('quantity', qty);
        formData.append('csrfmiddlewaretoken', csrfToken);
        
        // Show loading state
        const addButton = document.querySelector(`button[onclick*="addToCart(${productId})"]`);
        if (addButton) {
          const originalText = addButton.textContent;
          addButton.disabled = true;
          addButton.textContent = 'Adding...';
          
          // Revert button state after 2 seconds if request fails
          const revertButton = () => {
            addButton.disabled = false;
            addButton.textContent = originalText;
          };
          
          // Send POST request to add item to cart
          fetch(`/cart/add/${productId}/`, {
            method: 'POST',
            body: formData,
            headers: {
              'X-Requested-With': 'XMLHttpRequest',
            },
          })
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(data => {
            if (data.success) {
              showToast(data.message || 'Item added to cart!');
              // Update cart count in the header
              updateCartCount();
              // Update button to show success
              addButton.textContent = 'Added to Cart';
              setTimeout(revertButton, 2000);
            } else {
              showToast(data.error || 'Failed to add item to cart', 'error');
              revertButton();
            }
          })
          .catch(error => {
            console.error('Error:', error);
            showToast('An error occurred. Please try again.', 'error');
            revertButton();
          });
        }
      };
    });
  </script>
  
</body>
</html>
