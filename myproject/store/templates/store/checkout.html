{% extends 'store/base.html' %}
{% load static %}

{% block title %}Checkout - Ecommerce{% endblock %}

{% block extra_css %}
<style>
    .checkout-container {
        display: grid;
        grid-template-columns: 1.5fr 1fr;
        gap: 32px;
        margin-top: 32px;
        max-width: 1200px;
        margin: 32px auto 0;
        padding: 0 16px;
    }
    .checkout-form {
        background: #fff;
        padding: 32px 24px;
        border-radius: 10px;
        box-shadow: 0 2px 16px rgba(0,0,0,0.07);
    }
    .checkout-form h2 {
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e2e8f0;
        color: #2d3748;
    }
    .form-group {
        margin-bottom: 18px;
    }
    .form-group label {
        display: block;
        margin-bottom: 7px;
        font-weight: 500;
        color: #4a5568;
    }
    .form-group input,
    .form-group select {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        font-size: 15px;
        background: #f9fafb;
        transition: border-color 0.2s;
    }
    .form-group input:focus,
    .form-group select:focus {
        outline: none;
        border-color: #3182ce;
        background: #fff;
        box-shadow: 0 0 0 1px #3182ce;
    }
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
    }
    .payment-method {
        margin: 28px 0 18px 0;
    }
    .payment-option {
        display: flex;
        align-items: center;
        padding: 12px;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        margin-bottom: 10px;
        cursor: pointer;
        background: #f9fafb;
        transition: all 0.2s;
    }
    .payment-option:hover {
        border-color: #3182ce;
        background: #ebf8ff;
    }
    .payment-option input[type="radio"] {
        margin-right: 10px;
    }
    .payment-option i {
        margin-right: 10px;
        font-size: 22px;
        color: #4a5568;
    }
    .place-order-btn {
        width: 100%;
        padding: 15px;
        background: #3182ce;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 17px;
        font-weight: 600;
        cursor: pointer;
        margin-top: 10px;
        transition: background 0.2s;
    }
    .place-order-btn:hover {
        background: #2c5282;
    }
    .place-order-btn:disabled {
        background: #a0aec0;
        cursor: not-allowed;
    }
    .order-summary {
        background: #fff;
        padding: 28px 22px;
        border-radius: 10px;
        height: fit-content;
        box-shadow: 0 2px 16px rgba(0,0,0,0.07);
    }
    .order-summary h3 {
        margin-bottom: 18px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e2e8f0;
        color: #2d3748;
    }
    .order-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #e2e8f0;
    }
    .order-item:last-child {
        border-bottom: none;
    }
    .order-total {
        font-weight: 700;
        font-size: 19px;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #e2e8f0;
        color: #3182ce;
    }
    
    /* Success Notification */
    .success-notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #48bb78;
        color: white;
        padding: 20px 25px;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        z-index: 1000;
        transform: translateX(400px);
        transition: transform 0.3s ease;
        max-width: 400px;
    }
    
    .success-notification.show {
        transform: translateX(0);
    }
    
    .success-notification h4 {
        margin: 0 0 10px 0;
        font-size: 1.2rem;
        font-weight: 600;
    }
    
    .success-notification p {
        margin: 0;
        opacity: 0.9;
        line-height: 1.4;
    }
    
    .success-notification .close-btn {
        position: absolute;
        top: 10px;
        right: 15px;
        background: none;
        border: none;
        color: white;
        font-size: 18px;
        cursor: pointer;
        opacity: 0.7;
    }
    
    .success-notification .close-btn:hover {
        opacity: 1;
    }
    
    @media (max-width: 900px) {
        .checkout-container {
            grid-template-columns: 1fr;
        }
    }
    @media (max-width: 600px) {
        .checkout-form, .order-summary {
            padding: 16px 6px;
        }
        .success-notification {
            right: 10px;
            left: 10px;
            max-width: none;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Breadcrumb Section -->
<div class="breadcrumb-section">
    <div class="container">
        <div class="breadcrumb-content">
            <a href="{% url 'index' %}">Home</a>
            <span class="divider">/</span>
            <a href="{% url 'product_list' %}">Shop</a>
            <span class="divider">/</span>
            <span class="current">Checkout</span>
        </div>
    </div>
</div>

<!-- Checkout Section -->
<div class="container">
    <h1 style="color: #2d3748; font-size: 2.1rem; margin-bottom: 0.5em;">Checkout</h1>
    <div class="checkout-container">
        <div class="checkout-form">
            <h2>Shipping Information</h2>
            <form id="checkoutForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName">First Name *</label>
                        <input type="text" id="firstName" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name *</label>
                        <input type="text" id="lastName" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="address">Street Address *</label>
                    <input type="text" id="address" required>
                </div>
                <div class="form-group">
                    <label for="apartment">Apartment, suite, etc. (optional)</label>
                    <input type="text" id="apartment">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="city">City *</label>
                        <input type="text" id="city" required>
                    </div>
                    <div class="form-group">
                        <label for="state">State/Province *</label>
                        <select id="state" required>
                            <option value="">Select a state</option>
                            <option value="CA">California</option>
                            <option value="NY">New York</option>
                            <option value="TX">Texas</option>
                            <option value="FL">Florida</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="zip">ZIP/Postal Code *</label>
                        <input type="text" id="zip" required>
                    </div>
                    <div class="form-group">
                        <label for="country">Country *</label>
                        <select id="country" required>
                            <option value="">Select a country</option>
                            <option value="US" selected>United States</option>
                            <option value="CA">Canada</option>
                            <option value="UK">United Kingdom</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number *</label>
                    <input type="tel" id="phone" required>
                </div>
                <h2>Payment Method</h2>
                <div class="payment-method">
                    <label class="payment-option">
                        <input type="radio" name="payment" value="credit-card" checked>
                        <i class="far fa-credit-card"></i>
                        <span>Credit Card</span>
                    </label>
                    <label class="payment-option">
                        <input type="radio" name="payment" value="paypal">
                        <i class="fab fa-paypal"></i>
                        <span>PayPal</span>
                    </label>
                    <label class="payment-option">
                        <input type="radio" name="payment" value="apple-pay">
                        <i class="fab fa-apple-pay"></i>
                        <span>Apple Pay</span>
                    </label>
                </div>
                <div id="creditCardDetails" class="credit-card-details">
                    <div class="form-group">
                        <label for="cardNumber">Card Number *</label>
                        <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="expiryDate">Expiry Date *</label>
                            <input type="text" id="expiryDate" placeholder="MM/YY" required>
                        </div>
                        <div class="form-group">
                            <label for="cvv">CVV *</label>
                            <input type="text" id="cvv" placeholder="123" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="cardName">Name on Card *</label>
                        <input type="text" id="cardName" required>
                    </div>
                </div>
                <button type="submit" class="place-order-btn" id="submitBtn">Place Order</button>
            </form>
        </div>
        <div class="order-summary">
            <h3>Order Summary</h3>

            {% for item in cart_items %}
            <div class="order-item">
                <span>{{ item.product.name }} Ã— {{ item.quantity }}</span>
                <span>${{ item.total }}</span>
            </div>
            {% endfor %}

            <div class="order-item">
                <span>Subtotal</span>
                <span>${{ subtotal }}</span>
            </div>

            <div class="order-item">
                <span>Shipping</span>
                <span>${{ shipping }}</span>
            </div>

            <div class="order-item">
                <span>Tax (5%)</span>
                <span>${{ tax }}</span>
            </div>

            <div class="order-total">
                <strong>Total:</strong>
                <strong>${{ total }}</strong>
            </div>
        </div>
    </div>
</div>

<!-- Success Notification -->
<div id="successNotification" class="success-notification">
    <button class="close-btn" onclick="closeNotification()">&times;</button>
    <h4>ðŸŽ‰ Order Successful!</h4>
    <p>Thank you for your order! We have received your order and will contact you soon with order details and tracking information.</p>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Toggle payment method details
    document.querySelectorAll('input[name="payment"]').forEach(radio => {
        radio.addEventListener('change', function() {
            const creditCardDetails = document.getElementById('creditCardDetails');
            if (this.value === 'credit-card') {
                creditCardDetails.style.display = 'block';
            } else {
                creditCardDetails.style.display = 'none';
            }
        });
    });
    
    // Form submission with success notification
    document.getElementById('checkoutForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Disable submit button to prevent double submission
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Processing...';
        
        // Simulate processing time
        setTimeout(() => {
            // Show success notification
            showSuccessNotification();
            
            // Reset form
            document.getElementById('checkoutForm').reset();
            
            // Re-enable submit button
            submitBtn.disabled = false;
            submitBtn.textContent = 'Place Order';
            
            // Redirect to home page after 3 seconds
            setTimeout(() => {
                window.location.href = '{% url "index" %}';
            }, 3000);
        }, 1500);
    });
    
    // Show success notification
    function showSuccessNotification() {
        const notification = document.getElementById('successNotification');
        notification.classList.add('show');
        
        // Auto-hide after 5 seconds
        setTimeout(() => {
            closeNotification();
        }, 5000);
    }
    
    // Close notification
    function closeNotification() {
        const notification = document.getElementById('successNotification');
        notification.classList.remove('show');
    }
    
    // Format card number input
    document.getElementById('cardNumber').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        value = value.replace(/(\d{4})(?=\d)/g, '$1 ');
        e.target.value = value.trim();
    });
    
    // Format expiry date input
    document.getElementById('expiryDate').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length > 2) {
            value = value.substring(0, 2) + '/' + value.substring(2, 4);
        }
        e.target.value = value;
    });
</script>
{% endblock %}
